(this["webpackJsonpjira-assistant"]=this["webpackJsonpjira-assistant"]||[]).push([[31],{534:function(e,t,a){},854:function(e,t,a){"use strict";a.r(t);var r=a(8),o=a(5),n=a(6),s=a(46),i=a(243),l=a(37),c=a(15),u=a(16),d=a(2),m=a.n(d),f=a(3),p=a.n(f),g=a(533),h=a.n(g),b=a(35),y=a(244),k=a(112),v=a(242),C=a(117),E=a(274),j=(a(534),a(1)),w=a(10),N="Select an appropriate field for story point in Settings -> General -> Default values tab -> Story point field to enable this option.",S=[{backgroundColor:"#f1c40f4a",borderColor:"#f1c40f",hoverBackgroundColor:"#f1c40f",pointBackgroundColor:"rgba(148,159,177,1)",pointBorderColor:"#fff"},{backgroundColor:"#27ae614a",borderColor:"#27ae61",pointBackgroundColor:"rgba(77,83,96,1)",pointBorderColor:"#fff"},{backgroundColor:"#e84c3d4a",borderColor:"#e84c3d",pointBackgroundColor:"rgba(148,159,177,1)",pointBorderColor:"#fff"},{backgroundColor:"#8f44ad4a",borderColor:"#8f44ad",pointBackgroundColor:"rgba(148,159,177,1)",pointBorderColor:"#fff"},{backgroundColor:"#9a8d2f4a",borderColor:"#9a8d2f",pointBackgroundColor:"rgba(148,159,177,1)",pointBorderColor:"#fff"},{backgroundColor:"#3e95cd94",borderColor:"#3e95cd",hoverBackgroundColor:"#3e95cd",pointBackgroundColor:"rgba(148,159,177,1)",pointBorderColor:"#fff"},{backgroundColor:"#8e5ea27a",borderColor:"#8e5ea2",hoverBackgroundColor:"#8e5ea2",pointBackgroundColor:"rgba(148,159,177,1)",pointBorderColor:"#fff"},{backgroundColor:"#3cba9f7d",borderColor:"#3cba9f",pointBackgroundColor:"rgba(148,159,177,1)",pointBorderColor:"#fff"},{backgroundColor:"#e8c3b987",borderColor:"#e8c3b9",pointBackgroundColor:"rgba(148,159,177,1)",pointBorderColor:"#fff"},{backgroundColor:"#c4585080",borderColor:"#c45850",pointBackgroundColor:"rgba(148,159,177,1)",pointBorderColor:"#fff"},{backgroundColor:"rgba(148,159,177,0.2)",borderColor:"rgba(148,159,177,1)",pointBackgroundColor:"rgba(148,159,177,1)",pointBorderColor:"#fff"}],B=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e,"Estimate vs Actual report","fa fa-list-alt")).searchProject=function(e){return e=(e||"").toLowerCase(),n.state.projectsList.filter((function(t){return(t.name.toLowerCase().indexOf(e)>=0||t.key.toLowerCase().startsWith(e)||t.id.toString().startsWith(e))&&(!n.state.projects||!n.state.projects.some((function(e){return e.id===t.id})))}))},n.refreshData=function(){n.setState({isLoading:!0,chartData:{}});var e=p()(n.state.dateRange.fromDate).startOf("day"),t=p()(n.state.dateRange.toDate).endOf("day"),a=e.toDate(),o=t.toDate(),s=a.getTime(),i=o.getTime(),l=n.state.groups.union((function(e){return e.users.forEach((function(t){return t.groupName=e.name})),e.users})).distinctObj((function(e){return{name:Object(w.e)(e,!0),display:e.displayName}})),c=l.map((function(e){return Object(w.e)(e)})),u=l.map((function(e){return e.display})),d=n.state.projects,m=n.state.ticketsList;m=(m||"").trim().replace(/[\s;]/g,","),n.chartWidth=250*c.length;var f=m?m.split(",").filter((function(e){return!!e})):[],g='(worklogAuthor in ("'.concat(c.join('","'),"\") and worklogDate >= '").concat(e.clone().add(-1,"days").format("YYYY-MM-DD"),"' and worklogDate < '").concat(t.clone().add(1,"days").format("YYYY-MM-DD"),"') "),h="",b=d&&d.length>0,y=f.length>0;if(b&&(h+="project in (".concat(d.map((function(e){return e.key})).join(","),") ")),y){h&&(h+=" or ");var k=f.join(",");h+="key in (".concat(k,") or parent in (").concat(k,")")}return h&&(g+=" and (".concat(h,")")),n.$jira.searchTickets(g,["worklog","project","parent",n.state.estimationField]).then((function(e){n.$analytics.trackEvent("Estimate report viewed",j.i.UserActions);var t=e.flattern({key:!0,projectName:"fields.project.name",projectKey:"fields.project.key",parentkey:"fields.parent.key",estimate:function(e){var t=e.fields[n.state.estimationField];return"timeoriginalestimate"===n.state.estimationField?t=t/60/60:n.state.storyPointHour&&(t*=n.state.storyPointHour),t},"~~worklog":{field:"fields.worklog.worklogs",spread:!1,props:{"...author":function(e){return Object(w.e)(e.author,!0)},date:function(e){return e.started?new Date(e.started):null},"...yyyyMMdd":function(e){return e.started?parseInt(new Date(e.started).format("yyyyMMdd")):null},timespent:function(e){return e.timeSpentSeconds/60/60}}}},(function(e){return c.contains(e.author)&&e.worklog.date.isBetween(s,i)}));if("timeoriginalestimate"!==n.state.estimationField){var a=t.distinct((function(e){return e.parentkey}));if((a=a.filter((function(e){return e&&!t.some((function(t){return t.key===e}))}))).length)return n.$jira.searchTickets("key in (".concat(a.join(","),")"),["project",n.state.estimationField]).then((function(e){var a=e.flattern({key:!0,projectName:"fields.project.name",projectKey:"fields.project.key",estimate:function(e){var t=e.fields[n.state.estimationField];return"timeoriginalestimate"===n.state.estimationField?t=t/60/60:n.state.storyPointHour&&(t*=n.state.storyPointHour),t}}).reduce((function(e,t){return e[t.key]=t,e}),{});return t.forEach((function(e){var r=e.parentkey,o=e.key;if((!y||!f.contains(o))&&r){var n=a[r];n||(n=t.first((function(e){return e.key===r})),a[r]=n),e.key=r,delete e.parentkey,e.estimate=n.estimate}})),t}))}return t})).then((function(e){var t=n.state.projects;b||y||(b=!0,t=e.distinctObj((function(e){return{key:e.projectKey,name:e.projectName}})));var a=[],o=-1;b&&t.forEach((function(t){o++;var s=e.filter((function(e){return e.projectKey.toUpperCase()===t.key.toUpperCase()&&(!y||!f.contains(e.key))})),i=[],l=[],u=Object(r.a)({label:"".concat(t.name," (estimate)"),data:i},n.chartColours[o]);o++;var d=Object(r.a)({label:"".concat(t.name," (spent)"),data:l},n.chartColours[o]);c.forEach((function(e){var t=s.filter((function(t){return t.author===e})).groupBy((function(e){return e.key})),a=t.sum((function(e){return e.values[0].estimate})),r=t.sum((function(e){return e.values.sum((function(e){return e.worklog.timespent}))}));i.push(a),l.push(r)})),a.push(u),a.push(d)})),y&&((e=e.filter((function(e){return f.contains(e.parentkey)||f.contains(e.key)}))).forEach((function(e){f.contains(e.key)||(e.key=e.parentkey)})),e.groupBy((function(e){return e.key})).forEach((function(e){var t=e.values,r=[],o=[],n={label:"".concat(e.key," (estimate)"),data:r},s={label:"".concat(e.key," (spent)"),data:o};c.forEach((function(e){var a=t.filter((function(t){return t.author===e})).groupBy((function(e){return e.key})),n=a.sum((function(e){return e.values[0].estimate})),s=a.sum((function(e){return e.values.sum((function(e){return e.worklog.timespent}))}));n||(n=null),s||(s=null),r.push(n),o.push(s)})),a.push(n),a.push(s)}))),n.setState({disableRefresh:!1,isLoading:!1,chartData:{labels:u,datasets:a,colors:n.chartColours},selectedTab:1})}))},n.showGroupsPopup=function(){return n.setState({showGroupsPopup:!0})},n.groupsChanged=function(e){return n.setState({showGroupsPopup:!1,groups:e||n.state.groups||[]})},n.onDateChange=function(e){return n.setState({dateRange:e.date})},n.tabChanged=function(e){return n.setState({selectedTab:e.index})},Object(b.b)(Object(s.a)(n),"SessionService","JiraService","UserGroup","AnalyticsService"),n.hideMenu=!0,n.isGadget=!1,n.chartOptions={animation:!1,maintainAspectRatio:!1,title:{display:!0,text:"Estimate vs Actual"},tooltips:{mode:"index"},scales:{xAxes:[{stacked:!1,ticks:{stepSize:1,min:0,autoSkip:!1},categoryPercentage:1,barPercentage:1,barThickness:"flex"}]}},n.chartColours=S.union((function(e){return[Object.assign({},e,{hoverBackgroundColor:e.borderColor}),Object.assign({},e,{hoverBackgroundColor:h.a.draw("zigzag",e.backgroundColor),backgroundColor:h.a.draw("zigzag",e.borderColor)})]})),n.storyPointField=(n.$session.CurrentUser.storyPointField||{}).id,n.state={groups:[],disableRefresh:!0,dateRange:{},chartData:{},estimationField:"timeoriginalestimate",projects:n.$session.CurrentUser.projects},n}return Object(n.a)(a,[{key:"UNSAFE_componentWillMount",value:function(){var e=this;this.$usergroup.getUserGroups().then((function(t){return e.setState({groups:t||[]})})),this.$jira.getProjects().then((function(t){t=t.map((function(e){return{name:e.name,key:e.key,id:e.id}})).orderBy((function(e){return e.name})),e.setState({projectsList:t})}))}},{key:"resizeChart",value:function(e){e*=100;var t=window.Chart.instances,a=t[Object.keys(t)[0]].canvas,r=parseInt(a.style.width.replace("px",""));r>0?r>this.chartWidth&&(r=this.chartWidth):r=500,r+=e,a.parentNode.style.width="".concat(r,"px")}},{key:"validateData",value:function(){var e=this.state,t=e.dateRange,a=e.groups;return!(t||"").fromDate||!(a||"").length}},{key:"render",value:function(){var e=this,t=this.storyPointField,r=this.chartOptions,o=this.state,n=o.projectsList,s=o.projects,c=o.ticketsList,u=o.groups,d=o.estimationField,f=o.storyPointHour,p=o.dateRange,g=o.chartData,h=o.showGroupsPopup,b=o.selectedTab;return Object(i.a)(Object(l.a)(a.prototype),"renderBase",this).call(this,m.a.createElement(m.a.Fragment,null,m.a.createElement(k.TabView,{activeIndex:b,onTabChange:this.tabChanged},m.a.createElement(k.TabPanel,{header:"Settings"},m.a.createElement("div",{className:"pad-15"},m.a.createElement("strong",null,"How to use:")," To generate the estimate vs actual report follow the below steps",m.a.createElement("ul",null,m.a.createElement("li",null,"User list: Select the list of users for whom report need to be generated."),m.a.createElement("li",null,"Date range: Select the date range for which worklog details need to be fetched from jira"),m.a.createElement("li",null,"Projects: Select one or more projects to be displayed for each users. To auto populate this field, go to Settings -> General -> Default values tab and provide the value for projects field."),m.a.createElement("li",null,"Tickets list: Add one or more tickets seperated by comma. These tickets will be listed seperately for comparison."),m.a.createElement("li",null,"Estimate type: Estimation comparison can be done based on Time estimate or Story Point estimate. If story point is selected, then optionally hours per story point can be configured to convert story point to estimated hours."),m.a.createElement("li",null,m.a.createElement("b",null,"Note:")," If Story Point option under Estimate type is disabled, then go to SETTINGS -> General -> Default values (tab) and select appropriate field for Story Points"))),m.a.createElement("div",null,m.a.createElement("div",{className:"row"},m.a.createElement("div",{className:"col-sm-12 col-md-2 col-lg-2"},m.a.createElement("strong",null,"* User list")),m.a.createElement("div",{className:"col-sm-12 col-md-4 col-lg-4 col-xl-3"},m.a.createElement("div",{className:"form-group"},m.a.createElement("span",{className:"link",onClick:this.showGroupsPopup},"Add / remove users"))),m.a.createElement("div",{className:"col-sm-12 col-md-2 col-lg-2"},m.a.createElement("strong",null,"* Date range")),m.a.createElement("div",{className:"col-sm-12 col-md-4 col-lg-4 col-xl-3"},m.a.createElement("div",{className:"form-group"},m.a.createElement(v.e,{range:!0,value:p,onChange:function(t){return e.setState({dateRange:t})},width:200})))),m.a.createElement("div",{className:"row"},m.a.createElement("div",{className:"col-sm-12 col-md-2 col-lg-2"},m.a.createElement("strong",null,"Projects")),m.a.createElement("div",{className:"col-sm-12 col-md-5 col-lg-4 col-xl-3"},m.a.createElement("div",{className:"form-group"},m.a.createElement(v.a,{value:s,onChange:function(t){return e.setState({projects:t})},disabled:!n,dropdown:!0,multiple:!0,forceselection:!0,displayField:"name",placeholder:"add one or more projects",dataset:this.searchProject,size:35,autohighlight:!0,maxLength:25,className:"autocomplete-350"}))),m.a.createElement("div",{className:"col-sm-12 col-md-2 col-lg-2"},m.a.createElement("strong",null,"Tickets List")),m.a.createElement("div",{className:"col-sm-12 col-md-5 col-lg-4 col-xl-3"},m.a.createElement("div",{className:"form-group"},m.a.createElement(v.j,{multiline:!0,value:c,onChange:function(t){return e.setState({ticketsList:t})},placeholder:"List of tickets to be viewed seperated by comma"})))),m.a.createElement("div",{className:"row"},m.a.createElement("div",{className:"col-sm-12 col-md-2 col-lg-2"},m.a.createElement("strong",null,"* Estimate type")),m.a.createElement("div",{className:"col-sm-12 col-md-5 col-lg-4 col-xl-3"},m.a.createElement("div",{className:"form-group estimate-type"},m.a.createElement(v.h,{name:"estimateType",onChange:function(t){return e.setState({estimationField:t})},defaultValue:"timeoriginalestimate",value:d,label:"Time estimate"}),m.a.createElement(v.h,{name:"estimateType",defaultValue:t,value:d,label:"Story Point",title:t?"":N,onChange:function(t){return e.setState({estimationField:t})},disabled:!t}),!t&&m.a.createElement("span",{className:"fa fa-question-circle",title:N}))),d===t&&m.a.createElement("div",{className:"col-sm-12 col-md-2 col-lg-2"},m.a.createElement("strong",null,"Hours per Story point")),d===t&&m.a.createElement("div",{className:"col-sm-12 col-md-5 col-lg-4 col-xl-3"},m.a.createElement("div",{className:"form-group"},m.a.createElement(v.j,{value:f,onChange:function(t){return e.setState({storyPointHour:t})},maxLength:5,keyfilter:"num",placeholder:"Specify hours per story point in average"})))),m.a.createElement("div",{className:"row"},m.a.createElement("div",{className:"col-sm-12 col-md-3 col-lg-3 col-xl-2"},m.a.createElement(v.b,{className:"col-button-primary",disabled:this.validateData(),icon:"fa fa-play-circle",label:"Generate report",onClick:this.refreshData}))))),m.a.createElement(k.TabPanel,{header:"Chart",disabled:!g.datasets},m.a.createElement("div",{className:"chart-container"},m.a.createElement("div",{className:"magnifier"},m.a.createElement("i",{className:"fa fa-search-minus",onClick:function(){return e.resizeChart(-1)},title:"Decrease the width of the chart"}),m.a.createElement("i",{className:"fa fa-search-plus",onClick:function(){return e.resizeChart(1)},title:"Increase the width of the chart"})),m.a.createElement("div",{className:"canvas-block"},m.a.createElement("div",{className:"canvas-container"},m.a.createElement(C.Chart,{className:"chart",type:"bar",data:g,options:r})))))),h&&m.a.createElement(E.a,{groups:u,onHide:this.groupsChanged})))}}]),a}(y.b);t.default=B}}]);
//# sourceMappingURL=31.39d0e424.chunk.js.map