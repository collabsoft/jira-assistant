(this["webpackJsonpjira-assistant"]=this["webpackJsonpjira-assistant"]||[]).push([[28],{530:function(e,t,a){},851:function(e,t,a){"use strict";a.r(t);var o=a(31),r=a(5),n=a(6),l=a(46),s=a(243),c=a(37),i=a(15),u=a(16),m=a(2),d=a.n(m),g=a(245),k=a(420),p=a(9),f=a(242),v=(a(530),a(10)),h={ticketno:"ticketNo",ticket:"ticketNo",issuekey:"ticketNo",issue:"ticketNo",key:"ticketNo",id:"ticketNo",startdate:"startDate",started:"startDate",logdate:"startDate",loggeddate:"startDate",worklogdate:"startDate",date:"startDate",timespent:"timespent",timespentseconds:"timespent",seconds:"timespent",hoursspent:"timespent",time:"timespent",spent:"timespent",comment:"comment",comments:"comment",description:"comment",details:"comment"},y=function(e){Object(i.a)(a,e);var t=Object(u.a)(a);function a(e){var n;Object(r.a)(this,a),(n=t.call(this,e,"Worklog","fa fa-clock-o")).transformHeader=function(e){return h[e.replace(/ /g,"").toLowerCase()]||null},n.importWorklogs=function(){var e=n.state,t=e.autoUpload,a=e.worklogData,r=a.filter((function(e){return e.selected}));if(t)n.uploadSelectedWorklogs(r);else{var l=r.map((function(e){e.selected=!1,e.disabled=!0;var t=e.ticketNo,a=e.startDate,o=e.timespent,r=e.comment,l=Math.floor(o/3600),s=Math.floor(o%3600/60),c={ticketNo:t,dateStarted:a,timeSpent:"".concat(l.pad(2),":").concat(s.pad(2)),description:r};return n.$worklog.saveWorklog(c).then((function(t){e.id=t.id,e.status="Imported"}),(function(t){e.status="Error",e.error=t}))}));Promise.all(l).then((function(){n.$message.info("Worklog import completed"),n.setState({worklogData:Object(o.a)(a),selectedCount:""})}))}},n.toggleAllRows=function(){var e=n.state,t=e.selectAll,a=e.worklogData;if(a){var r=(t=!t)?"Will Import":"Excluded";(a=Object(o.a)(a)).forEach((function(e){e.disabled||(e.selected=t,e.status=r)})),n.setState({selectAll:t,worklogData:a,selectedCount:n.getSelectedLogs(a).length||""})}},n.getSelectedLogs=function(e){return(e||n.state.worklogData).filter((function(e){return e.selected}))},n.toggleAutoUpload=function(e){return n.setState({autoUpload:e})},n.toggleSelection=function(e,t){var a=n.state.worklogData;a=Object(o.a)(a),e.selected=!e.selected,e.status=e.selected?"Will Import":"Excluded",n.setState({worklogData:a,selectedCount:n.getSelectedLogs(a).length||""})},n.downloadTemplate=function(){var e=(new Date).format("dd-MMM-yyyy HH:mm:ss"),t=["Ticket No,Start Date,Timespent,Comment","JA-1001,".concat(e,",1w 2d 3h 4m,Logs 59 hours and 4 mins"),"JA-1001,".concat(e,",1d 1h,Logs 9 hours"),"JA-1002,".concat(e,",12.5,Logs 12 hours and 30 mins"),"JA-1003,".concat(e,",14:45,Logs 14 hours and 45 mins"),"JA-1003,".concat(e,",8,Logs 8 hours")];Object(v.a)(t.join("\n"),"sample_worklog")},n.clearWorklogs=function(){n.$q.reset(),n.setState({isLoading:!1,selectedCount:"",worklogData:null,ticketSummary:{},selectAll:!1})},Object(p.a)(Object(l.a)(n),"UtilsService","UserUtilsService","TicketService","QueueService","WorklogService","SessionService","MessageService"),n.maxHrsToLog=n.$session.CurrentUser.maxHours;var s=n.$session.CurrentUser.autoUpload||!1;return n.state={autoUpload:s,ticketSummary:{},selectedCount:""},n.$q.on("completed",(function(){n.$message.info("Worklog upload completed"),n.setState({isLoading:!1,selectedCount:""})})),n}return Object(n.a)(a,[{key:"processData",value:function(e){var t=this,a=e.map((function(e){var a=e.ticketNo,o=void 0===a?"":a,r=e.startDate,n=void 0===r?"":r,l=e.timespent,s=void 0===l?"":l,c=e.comment,i=void 0===c?"":c;o=o.trim(),n=n.trim(),s=s.trim(),i=i.trim();var u=!0,m=!1,d="Will Import",g="",k=function(e){u=!1,m=!0,d="Invalid",g?g+=";".concat(e):g=e};if(o||k("Ticket No is required"),n){var p=t.$utils.convertDate(n);p instanceof Date?n=p:k("Log Date is invalid")}else k("Log Date is required");if(s){var f=Object(v.i)(s);f>0?s=f:k("Timespent is invalid")}else k("Timespent is required");return{selected:u,disabled:m,status:d,error:g,ticketNo:o,startDate:n,timespent:s,comment:i}})),o=this.getSelectedLogs(a),r=o.map((function(e){return e.ticketNo})).distinct();this.$ticket.getTicketDetails(r,!0).then((function(e){var a=e.reduce((function(e,t){var a=t.key,o=t.fields,r=o.summary,n=o.assignee,l=o.issuetype,s=(l=void 0===l?{}:l).iconUrl,c=l.name,i=(n||{}).displayName;return e[a]={summary:r,assignee:i,issueTypeIcon:s,issueType:c},e}),{});t.setState({ticketSummary:a})}));var n=r.reduce((function(e,t){return e[t]={summary:"Loading..."},e}),{});this.setState({worklogData:a,ticketSummary:n,selectAll:!0,selectedCount:o.length||""})}},{key:"uploadSelectedWorklogs",value:function(e){var t=this;e.groupBy((function(e){return e.ticketNo})).forEach((function(e){t.$q.add((function(){var a=e.values;return 1===a.length?t.uploadWorklog(a[0]):a.reduce((function(e,a){return e.finally((function(){return t.uploadWorklog(a)}))}),Promise.resolve())}))})),this.$q.start()}},{key:"uploadWorklog",value:function(e){var t=this,a=e.ticketNo,r=e.startDate,n=e.timespent,l=e.comment;e.status="Uploading...",this.$worklog.upload(a,r,1e3*n,l).then((function(a){e.disabled=!0,e.selected=!1,e.status="Uploaded",e.worklogId=a.id,t.setState((function(e){var t=e.worklogData;return{worklogData:Object(o.a)(t)}}))}),(function(a){var r=a.message,n=a.error,l=(n=void 0===n?{}:n).errors,s=n.errorMessages;e.disabled=!0,e.selected=!1,e.status="Error";var c=l&&Object.keys(l);r?e.error=r:c&&c.length?e.error=c.reduce((function(e,t){var a=l[t];return e?"".concat(e,"; ").concat(a):a}),""):s&&s.length&&(e.error=s.reduce((function(e,t){return e?"".concat(e,"; ").concat(t):t}),"")),t.setState((function(e){var t=e.worklogData;return{worklogData:Object(o.a)(t)}}))})),this.setState((function(e){var t=e.worklogData;return{worklogData:Object(o.a)(t)}}))}},{key:"formatTimespent",value:function(e){return"number"===typeof e?this.$utils.formatSecs(e):e}},{key:"renderFooter",value:function(){var e=this.state,t=e.autoUpload,a=e.isLoading,o=e.selectedCount;return d.a.createElement("div",{className:"pnl-footer"},d.a.createElement("div",{className:"pull-left"},d.a.createElement(f.c,{checked:t,label:"Directly upload worklog to Jira",disabled:a,onChange:this.toggleAutoUpload})),d.a.createElement("div",{className:"pull-right"},d.a.createElement(f.b,{type:"info",icon:"fa fa-list",label:"Clear",disabled:a,onClick:this.clearWorklogs}),d.a.createElement(f.b,{type:"success",icon:t?"fa fa-upload":"fa fa-floppy-o",disabled:a||!(o>0),label:t?"Upload ".concat(o," worklogs"):"Import ".concat(o," worklogs"),onClick:this.importWorklogs})))}},{key:"getWorklogLink",value:function(e){var t=e.ticketNo,a=e.worklogId,o=e.status;return d.a.createElement("a",{className:"link",href:this.$userutils.getWorklogUrl(t,a),target:"_blank",rel:"noopener noreferrer"},o)}},{key:"render",value:function(){var e=this,t=this.state,o=t.worklogData,r=t.ticketSummary,n=t.selectAll;return Object(s.a)(Object(c.a)(a.prototype),"renderBase",this).call(this,d.a.createElement("div",{className:"import-worklog"},d.a.createElement(g.c,{dataset:o,className:"worklog-table"},d.a.createElement(g.e,null,d.a.createElement(g.f,null,d.a.createElement(g.a,null,d.a.createElement(f.c,{checked:n,onChange:this.toggleAllRows})),d.a.createElement(g.a,{sortBy:"ticketNo"},"Ticket No"),d.a.createElement(g.a,null,"Issue Type"),d.a.createElement(g.a,null,"Summary"),d.a.createElement(g.a,{sortBy:"startDate"},"Log Date"),d.a.createElement(g.a,{sortBy:"timespent"},"Timespent"),d.a.createElement(g.a,null,"Comment"),d.a.createElement(g.a,null,"Assignee"),d.a.createElement(g.a,{sortBy:"status"},"Status"))),d.a.createElement(g.d,null,(function(t,a){var o=r[t.ticketNo]||null,n=o||{summary:"Unavailable"};return d.a.createElement("tr",{key:a,className:t.error?"row-error":""},d.a.createElement("td",null,d.a.createElement(f.c,{checked:t.selected,disabled:t.disabled,onChange:function(){return e.toggleSelection(t,a)}})),o&&d.a.createElement("td",null,e.getTicketLink(t.ticketNo)),!o&&d.a.createElement("td",null,t.ticketNo),d.a.createElement("td",null,n.issueTypeIcon&&d.a.createElement("img",{src:n.issueTypeIcon,alt:""})," ",n.issueType),d.a.createElement("td",null,n.summary),d.a.createElement("td",null,e.formatDate(t.startDate)),d.a.createElement("td",null,e.formatTimespent(t.timespent)),d.a.createElement("td",null,t.comment),d.a.createElement("td",null,n.assignee),t.worklogId&&d.a.createElement("td",{title:"Worklog uploaded successfully"},e.getWorklogLink(t)),!t.worklogId&&d.a.createElement("td",{title:t.error},t.error&&d.a.createElement("span",{className:"fa fa-exclamation-triangle msg-error"})," ",t.status))})),d.a.createElement(g.b,{span:9},"Upload the list of worklogs by clicking the ( ",d.a.createElement("span",{className:"fa fa-upload"})," ) icon in top right corner. Click ",d.a.createElement("span",{className:"link",onClick:this.downloadTemplate},"here")," to download a sample template."))))}}]),a}(k.a);t.default=y}}]);
//# sourceMappingURL=28.ea3f766e.chunk.js.map